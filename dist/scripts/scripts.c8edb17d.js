"use strict";angular.module("jessesManager2App",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.router","ngTagsInput","uiGmapgoogle-maps","ngFileUpload"]).config(["$routeProvider","$stateProvider","$urlRouterProvider","uiGmapGoogleMapApiProvider",function(a,b,c,d){c.otherwise("/login"),b.state("login",{url:"/login",templateUrl:"/views/login.html",controller:"LoginCtrl"}).state("missionControl",{url:"/missionControl",templateUrl:"/views/mc.html",controller:"MissionControlCtrl"}).state("missionControl.orders",{url:"/orders",templateUrl:"/views/orders.html",controller:"OrdersCtrl"}).state("missionControl.restaurants",{url:"/restaurants",templateUrl:"/views/restaurants.html",controller:"RestaurantCtrl"}).state("missionControl.items",{url:"/items",templateUrl:"/views/items.html",controller:"ItemCtrl"}),d.configure({key:"AIzaSyBeGxejqsFtYezedrrV21WWIc1b_EivI7E",v:"3.17",libraries:"weather,geometry,visualization,places"})}]),angular.module("jessesManager2App").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("jessesManager2App").controller("LoginCtrl",["$scope","$q","$location","UserService","$window",function(a,b,c,d,e){this.user={},this.doLogin=function(a){b.all({login:d.doLogin(a)}).then(function(a){var b=a.login.data;e.sessionStorage.setItem("apiToken",b.apiToken),c.path("/missionControl")})["catch"](function(a){400==a.status?console.log("User not found"):404==a.status?console.log("Invalid password"):console.log("Unknown error")})}}]),angular.module("jessesManager2App").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("jessesManager2App").controller("MissionControlCtrl",["$scope","$q","$location","UserService","$window",function(a,b,c,d,e){b.all({user:d.getUserByApiToken(e.sessionStorage.apiToken),login:d.doLogin({phone:"2154590332",password:"password"})}).then(function(b){d.user=b.user.data,a.user=d.user,"admin"==a.user.role})["catch"](function(a){400==a.status?console.log(a):401==a.status?console.log(a):(console.log("Unknown error"),console.log(a))}),a.links=[{name:"Orders",state:"missionControl.orders",glyphicon:"glyphicon glyphicon-cutlery"},{name:"Vitals",state:"missionControl.vitals",glyphicon:"glyphicon glyphicon-stats"},{name:"Restaurants",state:"missionControl.restaurants",glyphicon:"glyphicon glyphicon-list"},{name:"Items",state:"missionControl.items",glyphicon:"glyphicon glyphicon-th"}]}]),angular.module("jessesManager2App").factory("UserService",["$http","ConnectionsService",function(a,b){var c=b.getUrl(),d={};return d.user={},d.restaurants={},d.doLogin=function(b){var d=c+"/user/login";return a({method:"POST",url:d,data:{phone:b.phone,password:b.password}})},d.getUserByApiToken=function(b){var d=c+"/user/apiToken";return a({method:"POST",url:d,data:{apiToken:b}})},d}]),angular.module("jessesManager2App").factory("RestaurantService",["$http","$window","ConnectionsService",function(a,b,c){var d=b.sessionStorage.apiToken,e={},f=c.getUrl();return e.getRestaurantsBy=function(b){var c=f+"/user/login";return a({method:"POST",url:c,data:{phone:b.phone,password:b.password}})},e.createRestaurant=function(b){var c=f+"/restaurant/create";return b.apiToken=d,a({method:"POST",url:c,data:b})},e.destroy=function(b){var c=f+"/restaurant/destroy/"+b;return a({method:"GET",url:c})},e.getItemsByRestaurant=function(b){var c=f+"/item?restaurantId="+b;return a({method:"GET",url:c})},e.addItem=function(b){var c=f+"/item";return a({method:"POST",url:c,data:b})},e.uploadItemImage=function(b,c){var d=f+"/item/imageUpload",e={itemId:c,image:b};return a({method:"POST",headers:{"Content-Type":"multipart/form-data"},url:d,data:e})},e.removeItem=function(b){var c=f+"/item/destroy/"+b.id;return a({method:"GET",url:c,data:b})},e}]),angular.module("jessesManager2App").factory("ConnectionsService",["$http","$window",function(a,b){var c=(b.sessionStorage.apiToken,"http://localhost:2730"),d=c,e={};return e.getUrl=function(){return d},e}]),angular.module("jessesManager2App").factory("ItemsService",["$http","ConnectionsService",function(a,b){var c=(b.getUrl(),{});return c.getItemsByRestaurant=function(a){},c}]),angular.module("jessesManager2App").factory("OrdersService",["$http","ConnectionsService",function(a,b){var c=b.getUrl(),d={};return d.deleteOrder=function(b){var d=c+"/order/"+b;return a({method:"DELETE",url:d})},d}]),angular.module("jessesManager2App").controller("RestaurantCtrl",["$scope","$q","$location","$window","UserService","RestaurantService","uiGmapGoogleMapApi",function(a,b,c,d,e,f,g){a.refreshRestaurants=function(){b.all({user:e.getUserByApiToken(d.sessionStorage.apiToken)}).then(function(b){e.user=b.user.data,a.restaurants=e.user.ownsRestaurants})["catch"](function(a){400===a.status?console.log(a):401===a.status?console.log(a):(console.log("Unknown error"),console.log(a))})},a.saveNewRestaurant=function(b){f.createRestaurant(b).then(function(){a.refreshRestaurants()})["catch"](function(a){console.log("Error creating new restaurant")})},a["delete"]=function(b){f.destroy(b.id).then(function(){a.refreshRestaurants()})},a.edit=function(a){alert("this functionality doesnt exist yet!")},a.refreshRestaurants(),a.shown=!1,a.newRestaurant={},g.then(function(b){a.map={center:{latitude:40.1451,longitude:-99.668},zoom:18},a.options={mapMaker:!0},a.marker={id:1};var c=new google.maps.places.Autocomplete(document.getElementById("autocomplete"),{types:[]});c.bindTo("bound",a.map),google.maps.event.addListener(c,"place_changed",function(){var b=c.getPlace();console.log(b),a.restaurant.google_place_id=b.place_id,a.restaurant.name=b.name,5==b.address_components.length?(a.restaurant.street=b.address_components[0].long_name,a.restaurant.city=b.address_components[1].long_name,a.restaurant.state=b.address_components[2].short_name,a.restaurant.country=b.address_components[3].short_name,a.restaurant.zipcode=b.address_components[4].long_name):(a.restaurant.street=b.address_components[0].long_name+" "+b.address_components[1].long_name,a.restaurant.city=b.address_components[2].long_name,a.restaurant.state=b.address_components[3].short_name,a.restaurant.country=b.address_components[4].short_name,a.restaurant.zipcode=b.address_components[5].long_name),a.restaurant.fullAddress=b.formatted_address,a.restaurant.phone=b.international_phone_number,a.restaurant.latitude=b.geometry.location.lat(),a.restaurant.longitude=b.geometry.location.lng();var d={latitude:a.restaurant.latitude,longitude:a.restaurant.longitude};a.map.refresh(d),a.marker.coords=d})})}]),angular.module("jessesManager2App").controller("ItemCtrl",["$scope","$q","$location","$window","UserService","RestaurantService","Upload",function(a,b,c,d,e,f,g){b.all({user:e.getUserByApiToken(d.sessionStorage.apiToken)}).then(function(b){e.user=b.user.data,a.restaurants=e.user.ownsRestaurants,a.selectedRestaurantId=a.restaurants[0].id||d.sessionStorage.selectedRestaurant,a.selectedRestaurant=h(a.selectedRestaurantId,a.restaurants),a.refreshItems(a.selectedRestaurantId)})["catch"](function(a){400==a.status?console.log(a):401==a.status?console.log(a):(console.log("Unknown error"),console.log(a))}),a.refreshItems=function(b){f.getItemsByRestaurant(b).then(function(b){a.items=b.data})},a.changeSelRestaurant=function(b){d.sessionStorage.setItem("selectedRestaurant",b.id),a.selectedRestaurant=b,a.selectedRestaurantId=b.id,f.getItemsByRestaurant(b.id).then(function(b){console.log(b),a.items=b.data})},a.addItem=function(b){console.log(b),b.restaurantId=a.selectedRestaurant.id,b.apiToken=d.sessionStorage.apiToken,f.addItem(b).then(function(b){console.log(b),a.upload(a.itemImage,b.data.id)})},a.removeItem=function(b){b.apiToken=d.sessionStorage.apiToken,f.removeItem(b).then(function(b){console.log("Removed item"),a.refreshItems(a.selectedRestaurant.id)})},a.upload=function(c,d){b.defer();if(c&&c.length)for(var e=0;e<c.length;e++){var h=c[e];g.upload({url:f.getUrl()+"/item/imageUpload/",file:h,fileFormDataName:"image",fields:{itemId:d},sendFieldsAs:"form"}).progress(function(a){}).success(function(b,c,d,e){console.log("file uploaded. Response: "),console.log(b),$("#newItemModal").modal("hide"),a.refreshItems(a.selectedRestaurant.id)})}};var h=function(a,b){for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c];return null}}]),angular.module("jessesManager2App").controller("OrdersCtrl",["$scope","$q","$location","$window","UserService","RestaurantService","OrdersService",function(a,b,c,d,e,f,g){a.orders=[],io.socket.on("order",function(b){console.log("in on"),console.log(b),"created"==b.verb&&(console.log("in created"),console.log(a.orders),a.orders.push(b.data),console.log(a.orders),a.$apply())}),io.socket.get("/order",function(b,c){console.log("in get"),console.log(b),a.orders=b}),b.all({user:e.getUserByApiToken(d.sessionStorage.apiToken)}).then(function(b){e.user=b.user.data,a.restaurants=e.user.ownsRestaurants,a.selectedRestaurantId=d.sessionStorage.selectedRestaurant||a.restaurants[0].id,a.selectedRestaurant=h(a.selectedRestaurantId,a.restaurants),a.refreshItems(a.selectedRestaurantId)})["catch"](function(a){400==a.status?console.log(a):401==a.status?console.log(a):(console.log("Unknown error"),console.log(a))}),a.refreshItems=function(b){f.getItemsByRestaurant(b).then(function(b){a.items=b.data})},a.deleteOrder=function(b){a.orders=a.orders.filter(function(a){return a.id!==b}),g.deleteOrder(b).then(function(a){console.log("Deleted:"),console.log(a)})};var h=function(a,b){for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c];return null}}]);